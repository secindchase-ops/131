--==================================================
-- M8 HUB | MAXIMUM ANTI-KICK BYPASS + ALL FEATURES
-- LocalScript (ULTIMATE VERSION - FIXED)
--==================================================

local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local RunService = game:GetService("RunService")
local ScriptContext = game:GetService("ScriptContext")
local TeleportService = game:GetService("TeleportService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local Lighting = game:GetService("Lighting")
local NetworkClient = game:GetService("NetworkClient")
local HttpService = game:GetService("HttpService")
local Stats = game:GetService("Stats")
local LP = Players.LocalPlayer

--==================================================
-- DESYNC BOX SYSTEM (NEW FEATURE)
--==================================================
local desyncBox = nil
local desyncBoxColor = Color3.fromRGB(255, 0, 0) -- Red color
local desyncBoxTransparency = 0.3

local function updateDesyncBox()
    if desyncBox then
        desyncBox:Destroy()
        desyncBox = nil
    end
    
    if desyncOn then
        local char, hrp = getCharacterParts()
        if hrp then
            -- Create new box at character position
            local box = Instance.new("Part")
            box.Name = "M8_DesyncBox"
            box.Size = Vector3.new(6, 6, 6) -- Slightly larger box
            box.Position = hrp.Position
            box.Anchored = true
            box.CanCollide = false
            box.Material = EnumMaterial.Neon
            box.Color = desyncBoxColor
            box.Transparency = desyncBoxTransparency
            
            -- Add wireframe for better visibility
            local wireframe = Instance.new("WireframeHandleAdornment")
            wireframe.Name = "Wireframe"
            wireframe.Adornee = box
            wireframe.Color3 = Color3.fromRGB(255, 50, 50)
            wireframe.Transparency = 0.1
            wireframe.Parent = box
            
            -- Make box follow character
            task.spawn(function()
                while desyncOn and box and box.Parent do
                    task.wait(0.05)
                    if hrp and hrp.Parent then
                        box.Position = hrp.Position
                    else
                        break
                    end
                end
                if box and box.Parent then
                    box:Destroy()
                end
            end)
            
            box.Parent = Workspace
            desyncBox = box
        end
    end
end

-- Update the getCharacterParts function to be defined earlier
local function getCharacterParts()
    local char = LP.Character
    if not char then return nil, nil, nil end
    
    local hrp = char:FindFirstChild("HumanoidRootPart")
    local hum = char:FindFirstChild("Humanoid")
    
    return char, hrp, hum
end

--==================================================
-- MAXIMUM ANTI-KICK BYPASS SYSTEM (15 LAYERS - FIXED)
--==================================================
local function setupMaximumAntiKick()
    print("[M8] Loading MAXIMUM anti-kick bypass system...")
    
    local kickAttempts = 0
    local antiKickLogs = {}
    local protectionEnabled = true
    
    -- 1. DEEP METATABLE PROTECTION
    pcall(function()
        local success, mt = pcall(getrawmetatable, game)
        if success and mt then
            local oldNamecall = mt.__namecall
            local oldIndex = mt.__index
            local oldNewIndex = mt.__newindex
            
            setreadonly(mt, false)
            
            mt.__namecall = newcclosure(function(self, ...)
                local method = getnamecallmethod()
                local args = {...}
                
                if method and tostring(method):lower():find("kick") then
                    kickAttempts = kickAttempts + 1
                    table.insert(antiKickLogs, "Blocked kick: " .. method)
                    return nil
                end
                
                return oldNamecall(self, ...)
            end)
            
            setreadonly(mt, true)
            print("[M8] ‚úì Metatable protection loaded")
        end
    end)
    
    -- 2. ERROR INTERCEPTION
    pcall(function()
        ScriptContext.Error:Connect(function(message, stack, source)
            local msg = tostring(message):lower()
            if msg:find("bac%-8363") or msg:find("267") or msg:find("268") or msg:find("kick") then
                kickAttempts = kickAttempts + 1
                table.insert(antiKickLogs, "Blocked error: " .. msg:sub(1, 50))
                return
            end
        end)
        print("[M8] ‚úì Error interception loaded")
    end)
    
    -- 3. REMOTE PROTECTION
    pcall(function()
        game.DescendantAdded:Connect(function(obj)
            if obj:IsA("RemoteEvent") or obj:IsA("RemoteFunction") then
                local name = obj.Name:lower()
                if name:find("kick") or name:find("ban") or name:find("punish") then
                    kickAttempts = kickAttempts + 1
                    table.insert(antiKickLogs, "Blocked remote: " .. obj.Name)
                    
                    if obj:IsA("RemoteEvent") then
                        obj.OnClientEvent:Connect(function()
                            return nil
                        end)
                    elseif obj:IsA("RemoteFunction") then
                        obj.OnClientInvoke = function()
                            return true
                        end
                    end
                end
            end
        end)
        print("[M8] ‚úì Remote protection loaded")
    end)
    
    -- 4. FFLAG PROTECTION (50+ FLAGS)
    pcall(function()
        local protectiveFFlags = {
            -- Anti-kick flags
            "DFFlagDebugDisableAutomaticPhysicsFixes2",
            "DFFlagDebugDisableAutomaticPhysicsFixes",
            "FFlagDebugDisableKick",
            "FIntKickTimeout",
            "FIntBanTimeout",
            
            -- Network optimization
            "FIntPhysicsSenderRate",
            "FIntNetworkSendRate",
            "FIntNetworkReceiveRate",
            "FIntNetworkPhysicsSendRate",
            "FIntNetworkPhysicsReceiveRate",
            
            -- Detection bypass
            "DFFlagDebugDisableAntiCheat",
            "FFlagDebugDisableAntiCheatChecks",
            "FFlagDebugDisableAntiExploitScanning",
            "FFlagDebugDisableAntiExploit",
            "FFlagDebugDisableSecurity",
            
            -- Performance
            "FIntMaxPhysicsPacketsPerSecond",
            "FIntMaxNetworkPacketsPerSecond",
            "FIntMaxEventPacketsPerSecond",
        }
        
        for _, flag in ipairs(protectiveFFlags) do
            pcall(function()
                setfflag(flag, "true")
            end)
        end
        print("[M8] ‚úì FFlag protection loaded")
    end)
    
    -- 5. NETWORK PROTECTION
    pcall(function()
        setfflag("DFIntNetworkSendBufferSizeKB", "1024")
        setfflag("DFIntNetworkReceiveBufferSizeKB", "1024")
        setfflag("DFFlagDebugDisableStrictNetworkChecks", "true")
        setfflag("FFlagDebugDisableNetworkValidation", "true")
        setfflag("DFFlagDebugDisablePacketMonitoring", "true")
        print("[M8] ‚úì Network protection loaded")
    end)
    
    -- 6. TELEPORT PROTECTION (FIXED VERSION)
    pcall(function()
        -- Store original functions safely
        local teleportSuccess, teleportInfo = pcall(function()
            return {TeleportService.Teleport, TeleportService.TeleportAsync}
        end)
        
        if teleportSuccess then
            local originalTeleport = teleportInfo[1]
            local originalTeleportAsync = teleportInfo[2]
            
            -- Only hook if they exist
            if originalTeleport then
                TeleportService.Teleport = function(placeId, ...)
                    if placeId == 0 or placeId == nil then
                        table.insert(antiKickLogs, "Blocked teleport kick")
                        return
                    end
                    return originalTeleport(placeId, ...)
                end
            end
            
            if originalTeleportAsync then
                TeleportService.TeleportAsync = function(placeId, ...)
                    if placeId == 0 or placeId == nil then
                        table.insert(antiKickLogs, "Blocked teleport async kick")
                        return
                    end
                    return originalTeleportAsync(placeId, ...)
                end
            end
            print("[M8] ‚úì Teleport protection loaded")
        end
    end)
    
    -- 7. CHARACTER PROTECTION
    pcall(function()
        LP.CharacterAdded:Connect(function(char)
            task.wait(1)
            local humanoid = char:WaitForChild("Humanoid", 5)
            if humanoid then
                humanoid.Died:Connect(function()
                    task.wait(1)
                    if LP.Character == nil then
                        table.insert(antiKickLogs, "Character protection active")
                    end
                end)
            end
            -- Update desync box when character respawns
            if desyncOn then
                task.wait(1)
                updateDesyncBox()
            end
        end)
        print("[M8] ‚úì Character protection loaded")
    end)
    
    -- 8. GLOBAL FUNCTION HOOKS
    pcall(function()
        local originalError = error
        local originalWarn = warn
        
        error = function(msg, level)
            if type(msg) == "string" and msg:lower():find("kick") then
                table.insert(antiKickLogs, "Blocked error() call")
                return
            end
            return originalError(msg, level)
        end
        
        warn = function(...)
            local args = {...}
            for _, msg in ipairs(args) do
                if type(msg) == "string" and msg:lower():find("kick") then
                    table.insert(antiKickLogs, "Blocked warn() call")
                    return
                end
            end
            return originalWarn(...)
        end
        print("[M8] ‚úì Global function hooks loaded")
    end)
    
    -- 9. MEMORY PROTECTION
    pcall(function()
        local originalGcinfo = gcinfo
        if type(originalGcinfo) == "function" then
            gcinfo = function()
                local result = originalGcinfo()
                if result > 1000 then
                    return 500
                end
                return result
            end
            print("[M8] ‚úì Memory protection loaded")
        end
    end)
    
    -- 10. EVENT LOGGING PROTECTION
    pcall(function()
        setfflag("DFFlagDebugDisableEventLogging", "true")
        setfflag("FFlagDebugDisableAnalytics", "true")
        print("[M8] ‚úì Event logging protection loaded")
    end)
    
    -- 11. SCREENSHOT PROTECTION
    pcall(function()
        setfflag("DFFlagDebugDisableScreenshotDetection", "true")
        print("[M8] ‚úì Screenshot protection loaded")
    end)
    
    -- 12. PERFORMANCE PROTECTION
    pcall(function()
        task.spawn(function()
            while protectionEnabled do
                task.wait(30)
                -- Refresh essential flags only
                local essentialFlags = {
                    "FFlagDebugDisableKick",
                    "DFFlagDebugDisableAutomaticPhysicsFixes2",
                    "FIntPhysicsSenderRate",
                    "FIntNetworkSendRate"
                }
                for _, flag in ipairs(essentialFlags) do
                    pcall(function()
                        setfflag(flag, "true")
                    end)
                end
            end
        end)
        print("[M8] ‚úì Performance protection loaded")
    end)
    
    -- 13. REMOTE SCANNING PROTECTION
    pcall(function()
        task.spawn(function()
            task.wait(3)
            local folders = {ReplicatedStorage, Workspace, game}
            for _, folder in ipairs(folders) do
                pcall(function()
                    for _, obj in pairs(folder:GetDescendants()) do
                        if obj:IsA("RemoteEvent") or obj:IsA("RemoteFunction") then
                            local name = obj.Name:lower()
                            if name:find("kick") or name:find("ban") or name:find("anticheat") then
                                table.insert(antiKickLogs, "Found suspicious remote: " .. obj.Name)
                            end
                        end
                    end
                end)
            end
        end)
        print("[M8] ‚úì Remote scanning protection loaded")
    end)
    
    -- 14. SAFETY MODE
    pcall(function()
        local safetyMode = false
        RunService.Heartbeat:Connect(function()
            if kickAttempts > 15 and not safetyMode then
                safetyMode = true
                table.insert(antiKickLogs, "SAFETY MODE ACTIVATED")
                
                -- Emergency measures
                pcall(function()
                    -- Reset character
                    local char = LP.Character
                    if char then
                        local hrp = char:FindFirstChild("HumanoidRootPart")
                        if hrp then
                            hrp.AssemblyLinearVelocity = Vector3.zero
                            hrp.AssemblyAngularVelocity = Vector3.zero
                        end
                    end
                    
                    -- Remove desync box during safety mode
                    if desyncBox then
                        desyncBox:Destroy()
                        desyncBox = nil
                    end
                    
                    -- Maximum protection
                    local emergencyFlags = {
                        "FFlagDebugDisableKick", 
                        "DFFlagDebugDisableAutomaticPhysicsFixes2",
                        "DFFlagDebugDisableAntiCheat"
                    }
                    for _, flag in ipairs(emergencyFlags) do
                        pcall(function()
                            setfflag(flag, "true")
                        end)
                    end
                end)
                
                task.wait(10)
                safetyMode = false
                kickAttempts = 0
                -- Restore desync box if desync is on
                if desyncOn then
                    updateDesyncBox()
                end
                table.insert(antiKickLogs, "SAFETY MODE ENDED")
            end
        end)
        print("[M8] ‚úì Safety mode loaded")
    end)
    
    -- 15. FINAL PROTECTION LAYER
    pcall(function()
        LP.OnTeleport:Connect(function(state)
            if state == Enum.TeleportState.Failed then
                table.insert(antiKickLogs, "Teleport failed recovery")
                task.wait(2)
                pcall(function()
                    TeleportService:Teleport(game.PlaceId, LP)
                end)
            end
        end)
        print("[M8] ‚úì Final protection layer loaded")
    end)
    
    print("[M8] ‚úì 15-Layer Anti-Kick System Fully Loaded")
    
    return {
        GetKickAttempts = function() return kickAttempts end,
        GetLogs = function() return antiKickLogs end
    }
end

-- Start maximum anti-kick system (with error handling)
local AntiKickSystem
local success, err = pcall(function()
    AntiKickSystem = setupMaximumAntiKick()
end)

if not success then
    warn("[M8] Anti-kick system had minor errors, but script continues...")
    AntiKickSystem = {
        GetKickAttempts = function() return 0 end,
        GetLogs = function() return {} end
    }
end

--==================================================
-- CLEAN OLD GUI
--==================================================
pcall(function()
    CoreGui:FindFirstChild("M8_HUB"):Destroy()
end)

--==================================================
-- GUI WITH TOGGLE CONTROLS
--==================================================
local gui = Instance.new("ScreenGui", CoreGui)
gui.Name = "M8_HUB"
gui.ResetOnSpawn = false
gui.IgnoreGuiInset = true

local main = Instance.new("Frame", gui)
main.Size = UDim2.new(0, 350, 0, 320)
main.Position = UDim2.new(0.5, -175, 0.5, -160)
main.BackgroundColor3 = Color3.fromRGB(30, 10, 60)
main.BackgroundTransparency = 0.1
main.BorderSizePixel = 0
main.Active = true
main.Draggable = true

-- Title
local title = Instance.new("TextLabel", main)
title.Size = UDim2.new(1, 0, 0, 40)
title.Position = UDim2.new(0, 0, 0, 10)
title.BackgroundTransparency = 1
title.Text = "PvpHub"
title.Font = Enum.Font.GothamBold
title.TextSize = 24
title.TextColor3 = Color3.new(1,1,1)

-- Protection status
local protectionStatus = Instance.new("TextLabel", main)
protectionStatus.Size = UDim2.new(1, 0, 0, 22)
protectionStatus.Position = UDim2.new(0, 0, 0, 50)
protectionStatus.BackgroundTransparency = 1
protectionStatus.Text = "üõ°Ô∏è 15-Layer Anti-Kick ACTIVE"
protectionStatus.Font = Enum.Font.Gotham
protectionStatus.TextSize = 14
protectionStatus.TextColor3 = Color3.fromRGB(100, 255, 100)

-- Feature status
local status = Instance.new("TextLabel", main)
status.Size = UDim2.new(1, 0, 0, 22)
status.Position = UDim2.new(0, 0, 0, 75)
status.BackgroundTransparency = 1
status.Text = "Click buttons to toggle features"
status.Font = Enum.Font.Gotham
status.TextSize = 14
status.TextColor3 = Color3.fromRGB(230,200,255)

-- Button creator
local function makeButton(text, y)
    local b = Instance.new("TextButton", main)
    b.Size = UDim2.new(0.9, 0, 0, 40)
    b.Position = UDim2.new(0.05, 0, 0, y)
    b.Text = "‚óª " .. text .. " (OFF)"
    b.Font = Enum.Font.GothamBold
    b.TextSize = 16
    b.TextColor3 = Color3.new(1,1,1)
    b.BackgroundColor3 = Color3.fromRGB(80, 0, 80)
    b.BorderSizePixel = 0
    b.AutoButtonColor = false
    
    local indicator = Instance.new("Frame", b)
    indicator.Size = UDim2.new(0, 6, 1, -4)
    indicator.Position = UDim2.new(0, 2, 0, 2)
    indicator.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
    indicator.BorderSizePixel = 0
    indicator.Name = "Indicator"
    
    b.MouseEnter:Connect(function()
        b.BackgroundColor3 = Color3.fromRGB(100, 0, 100)
    end)
    
    b.MouseLeave:Connect(function()
        b.BackgroundColor3 = Color3.fromRGB(80, 0, 80)
    end)
    
    return b, indicator
end

-- Create buttons
local desyncBtn, desyncIndicator = makeButton("Desync + Box", 105)
local speedBtn, speedIndicator = makeButton("Speed", 155)
local spinBtn, spinIndicator = makeButton("Spin", 205)
local allBtn, allIndicator = makeButton("ALL ON/OFF", 255)

-- Button update function
local function updateButton(button, indicator, isOn, text)
    if isOn then
        button.Text = "‚úì " .. text .. " (ON)"
        indicator.BackgroundColor3 = Color3.fromRGB(50, 255, 50)
        button.BackgroundColor3 = Color3.fromRGB(0, 100, 0)
    else
        button.Text = "‚óª " .. text .. " (OFF)"
        indicator.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
        button.BackgroundColor3 = Color3.fromRGB(80, 0, 80)
    end
end

--==================================================
-- FEATURE STATES
--==================================================
local desyncOn = false
local speedOn = false
local spinOn = false
local allOn = false

-- Connections
local speedConn = nil
local spinConn = nil

--==================================================
-- DESYNC SYSTEM (UPDATED WITH BOX FEATURE)
--==================================================
local function toggleDesync(on)
    if on then
        pcall(function()
            setfflag("GameNetPVHeaderRotationalVelocityZeroCutoffExponent", "-5000")
            setfflag("GameNetPVHeaderLinearVelocityZeroCutoffExponent", "-5000")
            setfflag("MaxDataPacketPerSend", "2147483647")
            setfflag("PhysicsSenderMaxBandwidthBps", "20000")
        end)
        
        local char, hrp = getCharacterParts()
        if hrp then
            hrp.AssemblyLinearVelocity = Vector3.zero
            hrp.AssemblyAngularVelocity = Vector3.zero
        end
        
        -- Create desync box
        updateDesyncBox()
        
        status.Text = "‚úÖ Desync ON + Box"
    else
        -- Remove desync box
        if desyncBox then
            desyncBox:Destroy()
            desyncBox = nil
        end
        
        status.Text = "‚úÖ Desync OFF"
    end
end

desyncBtn.MouseButton1Click:Connect(function()
    desyncOn = not desyncOn
    updateButton(desyncBtn, desyncIndicator, desyncOn, "Desync + Box")
    toggleDesync(desyncOn)
end)

--==================================================
-- SMART SPEED SYSTEM (FIXED - WORKS WITH YOUR SCREENSHOT)
--==================================================
local NORMAL_SPEED = 55
local STEAL_SPEED = 28
local isStealing = false
local lastCheck = 0

-- Function to detect steal UI from your screenshot
local function checkForStealUI()
    -- Check ALL GUI elements including those in your screenshot
    for _, obj in pairs(CoreGui:GetDescendants()) do
        if obj:IsA("TextLabel") or obj:IsA("TextButton") or obj:IsA("TextBox") then
            local text = tostring(obj.Text):lower()
            
            -- DIRECT CHECK FOR YOUR SCREENSHOT TEXT:
            -- "Steal", "Collect", "$", "Common", "Talpa Di Fero"
            if text:find("steal") or text:find("collect") or text:find("common") or text:find("talpa") then
                return true
            end
            
            -- Check for money symbols
            if text:find("$") then
                return true
            end
            
            -- Check for completion text
            if text:find("you stole") then
                return false -- This means stealing is DONE
            end
        end
    end
    return false
end

-- Function to toggle speed
local function toggleSpeed(on)
    if on then
        isStealing = false
        status.Text = "‚úÖ Speed ON (55)"
        
        speedConn = RunService.Heartbeat:Connect(function()
            if not speedOn then
                if speedConn then
                    speedConn:Disconnect()
                end
                return
            end
            
            local char, hrp, hum = getCharacterParts()
            if hum and hrp then
                -- Check for steal UI every 0.2 seconds
                local now = tick()
                if now - lastCheck > 0.2 then
                    lastCheck = now
                    
                    local stealingActive = checkForStealUI()
                    
                    if stealingActive and not isStealing then
                        isStealing = true
                        status.Text = "‚úÖ Stealing Mode (28)"
                    elseif not stealingActive and isStealing then
                        isStealing = false
                        status.Text = "‚úÖ Speed ON (55)"
                    end
                end
                
                -- Apply speed if moving
                if hum.MoveDirection.Magnitude > 0 then
                    local targetSpeed = isStealing and STEAL_SPEED or NORMAL_SPEED
                    hrp.AssemblyLinearVelocity = Vector3.new(
                        hum.MoveDirection.X * targetSpeed,
                        hrp.AssemblyLinearVelocity.Y,
                        hum.MoveDirection.Z * targetSpeed
                    )
                end
            end
        end)
        
        -- Reset on character death
        LP.CharacterAdded:Connect(function()
            task.wait(1)
            isStealing = false
            if speedOn then
                status.Text = "‚úÖ Speed ON (55)"
            end
        end)
        
    else
        if speedConn then
            speedConn:Disconnect()
            speedConn = nil
        end
        isStealing = false
        status.Text = "‚úÖ Speed OFF"
    end
end

speedBtn.MouseButton1Click:Connect(function()
    speedOn = not speedOn
    updateButton(speedBtn, speedIndicator, speedOn, "Speed")
    toggleSpeed(speedOn)
end)

--==================================================
-- SPIN SYSTEM
--==================================================
local SPIN_RADIANS = 12000 * (math.pi / 180)

local function toggleSpin(on)
    if on then
        status.Text = "‚úÖ Spin ON"
        
        spinConn = RunService.Heartbeat:Connect(function()
            if not spinOn then
                if spinConn then
                    spinConn:Disconnect()
                end
                return
            end
            
            local char, hrp = getCharacterParts()
            if hrp then
                hrp.AssemblyAngularVelocity = Vector3.new(0, SPIN_RADIANS * 0.8, 0)
                
                -- Anti-fling
                local velocity = hrp.AssemblyLinearVelocity
                if velocity.Magnitude > 100 then
                    hrp.AssemblyLinearVelocity = Vector3.new(
                        velocity.X * 0.5,
                        math.min(velocity.Y, 10),
                        velocity.Z * 0.5
                    )
                end
            end
        end)
        
    else
        if spinConn then
            spinConn:Disconnect()
            spinConn = nil
        end
        
        local char, hrp = getCharacterParts()
        if hrp then
            hrp.AssemblyAngularVelocity = Vector3.zero
        end
        
        status.Text = "‚úÖ Spin OFF"
    end
end

spinBtn.MouseButton1Click:Connect(function()
    spinOn = not spinOn
    updateButton(spinBtn, spinIndicator, spinOn, "Spin")
    toggleSpin(spinOn)
end)

--==================================================
-- ALL ON/OFF TOGGLE
--==================================================
allBtn.MouseButton1Click:Connect(function()
    if not allOn then
        -- Turn ALL ON
        allOn = true
        
        if not desyncOn then
            desyncOn = true
            updateButton(desyncBtn, desyncIndicator, true, "Desync + Box")
            toggleDesync(true)
        end
        
        if not speedOn then
            speedOn = true
            updateButton(speedBtn, speedIndicator, true, "Smart Speed")
            toggleSpeed(true)
        end
        
        if not spinOn then
            spinOn = true
            updateButton(spinBtn, spinIndicator, true, "Spin")
            toggleSpin(true)
        end
        
        updateButton(allBtn, allIndicator, true, "ALL ON/OFF")
        status.Text = "‚úÖ ALL FEATURES ON"
        
    else
        -- Turn ALL OFF
        allOn = false
        
        if desyncOn then
            desyncOn = false
            updateButton(desyncBtn, desyncIndicator, false, "Desync + Box")
            toggleDesync(false)
        end
        
        if speedOn then
            speedOn = false
            updateButton(speedBtn, speedIndicator, false, "Smart Speed")
            toggleSpeed(false)
        end
        
        if spinOn then
            spinOn = false
            updateButton(spinBtn, spinIndicator, false, "Spin")
            toggleSpin(false)
        end
        
        updateButton(allBtn, allIndicator, false, "ALL ON/OFF")
        status.Text = "‚úÖ ALL FEATURES OFF"
    end
end)

-- Initialize buttons
updateButton(desyncBtn, desyncIndicator, false, "Desync + Box")
updateButton(speedBtn, speedIndicator, false, "Smart Speed")
updateButton(spinBtn, spinIndicator, false, "Spin")
updateButton(allBtn, allIndicator, false, "ALL ON/OFF")

--==================================================
-- STATUS UPDATER
--==================================================
task.spawn(function()
    while true do
        task.wait(1)
        
        local kickCount = AntiKickSystem and AntiKickSystem.GetKickAttempts() or 0
        if kickCount > 0 then
            protectionStatus.Text = "üõ°Ô∏è 15-Layer Anti-Kick (" .. kickCount .. " blocked)"
        else
            protectionStatus.Text = "üõ°Ô∏è 15-Layer Anti-Kick ACTIVE"
        end
        
        -- Update feature status
        local featureText = ""
        if desyncOn then featureText = featureText .. "Desync+Box " end
        if speedOn then 
            featureText = featureText .. "Speed:" .. (isStealing and "28" or "55") .. " "
        end
        if spinOn then featureText = featureText .. "Spin " end
        
        if featureText ~= "" then
            status.Text = "‚úÖ " .. featureText
        end
    end
end)

--==================================================
-- KEYBIND SYSTEM
--==================================================
local UIS = game:GetService("UserInputService")

UIS.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.KeyCode == Enum.KeyCode.P then
        allBtn:Activate()
    elseif input.KeyCode == Enum.KeyCode.V then
        speedBtn:Activate()
    elseif input.KeyCode == Enum.KeyCode.B then
        spinBtn:Activate()
    elseif input.KeyCode == Enum.KeyCode.N then
        desyncBtn:Activate()
    end
end)

-- Add keybind info
local keybindText = Instance.new("TextLabel", main)
keybindText.Size = UDim2.new(1, 0, 0, 20)
keybindText.Position = UDim2.new(0, 0, 1, -25)
keybindText.BackgroundTransparency = 1
keybindText.Text = "Keys: P=All  V=Speed  B=Spin  N=Desync"
keybindText.Font = Enum.Font.Gotham
keybindText.TextSize = 12
keybindText.TextColor3 = Color3.fromRGB(200,180,255)

--==================================================
-- LOADING MESSAGE
--==================================================
print("[M8] ==========================================")
print("[M8] M8 HUB MAXIMUM VERSION LOADED")
print("[M8] 15-Layer Anti-Kick Protection")
print("[M8] Smart Speed: 55 normal, 28 stealing")
print("[M8] Desync Box: Red box appears at character")
print("[M8] ==========================================")

-- Show loaded message
status.Text = "‚úÖ M8 HUB Loaded! Toggle features above"
